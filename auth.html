<!DOCTYPE html>
<html>
<head>
    <title>Spotify Auth</title>
    <script>
    const validOrigins = [
        'https://live.bilibili.com',
        'https://oblivionh.github.io'
    ];

    window.addEventListener('load', () => {
        const params = new URLSearchParams(location.search);
        const openerOrigin = window.opener?.location.origin;
        
        if (validOrigins.includes(openerOrigin)) {
            window.opener.postMessage({
                type: 'spotify_code',
                code: params.get('code'),
                _signature: 'bili_' + Date.now()
            }, openerOrigin);
            setTimeout(() => window.close(), 800);
        } else {
            document.body.innerHTML = `<h1 style="color:red">安全错误：非法来源</h1>`;
        }
    });
    </script>
</head>
<body>
    <h2>授权完成，正在返回...</h2>
</body>
</html>
